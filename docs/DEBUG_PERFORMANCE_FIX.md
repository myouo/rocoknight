# Debug窗口性能问题修复

## 问题描述

打开debug窗口后，程序性能严重下降。

## 根本原因

原始实现中，每次调用 `debug_info!`、`debug_warn!` 等宏时，都会无条件地向Tauri事件系统发送事件。即使debug窗口没有打开，这些事件仍然会被创建和发送，导致：

1. 大量的JSON序列化操作
2. 频繁的事件分发
3. 不必要的内存分配
4. 事件队列积压

当程序有大量日志输出时（如游戏运行时的网络封包处理），这些开销会累积，严重影响性能。

## 解决方案

使用原子布尔标志 `DEBUG_WINDOW_OPEN` 来跟踪debug窗口的状态：

1. **添加状态标志**：使用 `AtomicBool` 记录debug窗口是否打开
2. **早期返回**：在 `debug_log` 函数中，如果窗口未打开，直接返回，避免任何事件处理
3. **状态同步**：
   - 打开debug窗口时，设置标志为 `true`
   - 监听窗口关闭事件，设置标志为 `false`

## 性能优化效果

- **窗口关闭时**：零开销，所有debug日志调用都会在检查标志后立即返回
- **窗口打开时**：正常发送日志事件，不影响调试功能
- **原子操作**：使用 `Ordering::Relaxed`，性能开销极小（通常只需1-2个CPU周期）

## 代码变更

### src-tauri/src/debug.rs
- 添加 `DEBUG_WINDOW_OPEN` 原子标志
- 添加 `set_debug_window_state()` 函数
- 在 `debug_log()` 中添加早期返回检查

### src-tauri/src/main.rs
- 在 `open_debug_window()` 中设置窗口打开状态
- 监听窗口关闭事件，更新状态

## 使用建议

1. 只在需要调试时打开debug窗口
2. 调试完成后关闭窗口，恢复最佳性能
3. 日志仍然会写入文件，不会丢失
